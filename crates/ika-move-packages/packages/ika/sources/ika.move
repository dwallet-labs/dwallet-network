
// Copyright (c) dWallet Labs, Ltd.
// SPDX-License-Identifier: BSD-3-Clause-Clear

/// The IKA for the Ika Protocol.
/// Coin<IKA> is the token used to pay for gas in Ika.
/// It has 9 decimals, and the smallest unit (10^-9) is called "INKU".
module ika::ika;

use sui::coin;
use sui::url;

/// The OTW for the `IKA` coin.
public struct IKA has drop {}

/// The amount of INKU per IKA token based on the fact that INKU is
/// 10^-9 of a IKA token
const INKU_PER_IKA: u64 = 1_000_000_000;
const INITIAL_IKA_SUPPLY_TO_MINT: u64 = 10_000_000_000; // 10B IKA
const DECIMALS: u8 = 9;
const SYMBOL: vector<u8> = b"IKA";
const NAME: vector<u8> = b"IKA Token";
const DESCRIPTION: vector<u8> = b"Ika Protocol.";
const ICON_URL: vector<u8> = b"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAwIiBoZWlnaHQ9IjEwMDAiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGZpbGw9Im5vbmUiPiA8cmVjdCB3aWR0aD0iMTAwMCIgaGVpZ2h0PSIxMDAwIiBmaWxsPSIjRUUyQjVCIi8+IDxwYXRoIGQ9Ik02NzguNzQyIDU4OC45MzRWNDEwLjQ2N0M2NzguNzQyIDMxMS45MDIgNTk4Ljg0IDIzMiA1MDAuMjc1IDIzMlYyMzJDNDAxLjcxIDIzMiAzMjEuODA4IDMxMS45MDIgMzIxLjgwOCA0MTAuNDY3VjU4OC45MzQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iNTcuMzIyOCIvPiA8cGF0aCBkPSJNNjc4Ljc0OCA1MjkuNDQxTDY3OC43NDggNTk4Ljg0NUM2NzguNzQ4IDYzNy4xNzYgNzA5LjgyMiA2NjguMjQ5IDc0OC4xNTIgNjY4LjI0OVY2NjguMjQ5Qzc4Ni40ODMgNjY4LjI0OSA4MTcuNTU2IDYzNy4xNzYgODE3LjU1NiA1OTguODQ1TDgxNy41NTYgNTI5LjQ0MSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSI1Ny4zMjI4Ii8+IDxwYXRoIGQ9Ik01NzMuNDkxIDc2OC45MThMNTczLjQ5MSA2NjMuMTU5QzU3My40OTEgNjIyLjcyMyA1NDAuNzExIDU4OS45NDIgNTAwLjI3NCA1ODkuOTQyVjU4OS45NDJDNDU5LjgzNyA1ODkuOTQyIDQyNy4wNTYgNjIyLjcyMyA0MjcuMDU2IDY2My4xNTlMNDI3LjA1NiA3NjguOTE4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjU3LjMyMjgiLz4gPHBhdGggZD0iTTE4MyA1MjkuNDQxTDE4MyA1OTguODQ1QzE4MyA2MzcuMTc2IDIxNC4wNzMgNjY4LjI0OSAyNTIuNDA0IDY2OC4yNDlWNjY4LjI0OUMyOTAuNzM1IDY2OC4yNDkgMzIxLjgwOCA2MzcuMTc2IDMyMS44MDggNTk4Ljg0NUwzMjEuODA4IDUyOS40NDEiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iNTcuMzIyOCIvPiA8cGF0aCBkPSJNNTAwLjI3MiAzNzAuNzk4QzUzMy4xMjcgMzcwLjc5OCA1NTkuNzYxIDM5Ny40MzMgNTU5Ljc2MSA0MzAuMjg4QzU1OS43NjEgNDYzLjE0MiA1MzMuMTI3IDQ4OS43NzcgNTAwLjI3MiA0ODkuNzc3QzQ5NC4xNzQgNDg5Ljc3NyA0ODguMjkgNDg4Ljg1OCA0ODIuNzUxIDQ4Ny4xNTNDNDkzLjA4MiA0ODIuNDkgNTAwLjI3MiA0NzIuMSA1MDAuMjcyIDQ2MC4wMjlDNTAwLjI3MiA0NDMuNjAyIDQ4Ni45NTUgNDMwLjI4NSA0NzAuNTI4IDQzMC4yODVDNDU4LjQ1OCA0MzAuMjg1IDQ0OC4wNjcgNDM3LjQ3MyA0NDMuNDA0IDQ0Ny44MDJDNDQxLjcwMSA0NDIuMjY1IDQ0MC43ODMgNDM2LjM4MyA0NDAuNzgzIDQzMC4yODhDNDQwLjc4MyAzOTcuNDMzIDQ2Ny40MTcgMzcwLjc5OCA1MDAuMjcyIDM3MC43OThaIiBmaWxsPSJ3aGl0ZSIvPiA8L3N2Zz4=";
const STAKED_IKA_ICON_URL: vector<u8> = b"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAwIiBoZWlnaHQ9IjEwMDAiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGZpbGw9Im5vbmUiPiA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfNjk5XzIyKSI+IDxwYXRoIGQ9Ik0wIDMwLjAwMTZDMCAxMy40MzMgMTMuNDMxNCAwIDMwIDBDMzQwLjI5NCAwIDY1MC44NTYgMCA5NjkuOTk4IDBDOTg2LjU2NyAwIDEwMDAgMTMuNDMxNCAxMDAwIDMwQzEwMDAgMzQwLjI5NCAxMDAwIDY1MC44NTYgMTAwMCA5NjkuOTk4QzEwMDAgOTg2LjU2NyA5ODYuNTY5IDEwMDAgOTcwIDEwMDBDNjU5LjcwNiAxMDAwIDM0OS4xNDQgMTAwMCAzMC4wMDE2IDEwMDBDMTMuNDMzIDEwMDAgMCA5ODYuNTY5IDAgOTcwQzAgNjU5LjcwNiAwIDM0OS4xNDQgMCAzMC4wMDE2WiIgZmlsbD0iI0VFMkI1QiIvPiA8cGF0aCBkPSJNNDUyIDE5NEM0ODMuNjggMTk0IDUxNS4zNiAxOTQgNTQ4IDE5NEM1NDggMjA0LjU2IDU0OCAyMTUuMTIgNTQ4IDIyNkM1NjkuNDUgMjI2IDU5MC45IDIyNiA2MTMgMjI2QzYxMyAyMzYuNTYgNjEzIDI0Ny4xMiA2MTMgMjU4QzYyMy41NiAyNTggNjM0LjEyIDI1OCA2NDUgMjU4QzY0NSAyNjguNTYgNjQ1IDI3OS4xMiA2NDUgMjkwQzY1NS41NiAyOTAgNjY2LjEyIDI5MCA2NzcgMjkwQzY3NyAzMDAuODkgNjc3IDMxMS43OCA2NzcgMzIzQzY4Ny44OSAzMjMgNjk4Ljc4IDMyMyA3MTAgMzIzQzcxMCA0MjkuMjYgNzEwIDUzNS41MiA3MTAgNjQ1QzczMS4xMiA2NDUgNzUyLjI0IDY0NSA3NzQgNjQ1Qzc3NCA2MDIuNDMgNzc0IDU1OS44NiA3NzQgNTE2Qzc5NS40NSA1MTYgODE2LjkgNTE2IDgzOSA1MTZDODM5IDU2OS4xMyA4MzkgNjIyLjI2IDgzOSA2NzdDODE3LjU1IDY3NyA3OTYuMSA2NzcgNzc0IDY3N0M3NzQgNjg3Ljg5IDc3NCA2OTguNzggNzc0IDcxMEM3NTIuODggNzEwIDczMS43NiA3MTAgNzEwIDcxMEM3MTAgNjk5LjExIDcxMCA2ODguMjIgNzEwIDY3N0M2OTkuMTEgNjc3IDY4OC4yMiA2NzcgNjc3IDY3N0M2NzcgNjY2LjQ0IDY3NyA2NTUuODggNjc3IDY0NUM2NjYuNDQgNjQ1IDY1NS44OCA2NDUgNjQ1IDY0NUM2NDUgNTM4Ljc0IDY0NSA0MzIuNDggNjQ1IDMyM0M2MzQuNDQgMzIzIDYyMy44OCAzMjMgNjEzIDMyM0M2MTMgMzEyLjExIDYxMyAzMDEuMjIgNjEzIDI5MEM1OTEuNTUgMjkwIDU3MC4xIDI5MCA1NDggMjkwQzU0OCAyNzkuNDQgNTQ4IDI2OC44OCA1NDggMjU4QzUxNi4zMiAyNTggNDg0LjY0IDI1OCA0NTIgMjU4QzQ1MiAyNjguNTYgNDUyIDI3OS4xMiA0NTIgMjkwQzQzMC41NSAyOTAgNDA5LjEgMjkwIDM4NyAyOTBDMzg3IDMwMC44OSAzODcgMzExLjc4IDM4NyAzMjNDMzc2LjQ0IDMyMyAzNjUuODggMzIzIDM1NSAzMjNDMzU1IDQyOS4yNiAzNTUgNTM1LjUyIDM1NSA2NDVDMzQ0LjQ0IDY0NSAzMzMuODggNjQ1IDMyMyA2NDVDMzIzIDY1NS41NiAzMjMgNjY2LjEyIDMyMyA2NzdDMzEyLjExIDY3NyAzMDEuMjIgNjc3IDI5MCA2NzdDMjkwIDY4Ny44OSAyOTAgNjk4Ljc4IDI5MCA3MTBDMjY4Ljg4IDcxMCAyNDcuNzYgNzEwIDIyNiA3MTBDMjI2IDY5OS4xMSAyMjYgNjg4LjIyIDIyNiA2NzdDMjA0LjU1IDY3NyAxODMuMSA2NzcgMTYxIDY3N0MxNjEgNjIzLjg3IDE2MSA1NzAuNzQgMTYxIDUxNkMxODIuNDUgNTE2IDIwMy45IDUxNiAyMjYgNTE2QzIyNiA1NTguNTcgMjI2IDYwMS4xNCAyMjYgNjQ1QzI0Ny4xMiA2NDUgMjY4LjI0IDY0NSAyOTAgNjQ1QzI5MCA1MzguNzQgMjkwIDQzMi40OCAyOTAgMzIzQzMwMC44OSAzMjMgMzExLjc4IDMyMyAzMjMgMzIzQzMyMyAzMTIuMTEgMzIzIDMwMS4yMiAzMjMgMjkwQzMzMy41NiAyOTAgMzQ0LjEyIDI5MCAzNTUgMjkwQzM1NSAyNzkuNDQgMzU1IDI2OC44OCAzNTUgMjU4QzM2NS41NiAyNTggMzc2LjEyIDI1OCAzODcgMjU4QzM4NyAyNDcuNDQgMzg3IDIzNi44OCAzODcgMjI2QzQwOC40NSAyMjYgNDI5LjkgMjI2IDQ1MiAyMjZDNDUyIDIxNS40NCA0NTIgMjA0Ljg4IDQ1MiAxOTRaIiBmaWxsPSJ3aGl0ZSIvPiA8cGF0aCBkPSJNNDg0IDU0OEM0OTQuNTYgNTQ4IDUwNS4xMiA1NDggNTE2IDU0OEM1MTYgNTU4Ljg5IDUxNiA1NjkuNzggNTE2IDU4MUM1MzcuNDUgNTgxIDU1OC45IDU4MSA1ODEgNTgxQzU4MSA2MDIuMTIgNTgxIDYyMy4yNCA1ODEgNjQ1QzU5MS41NiA2NDUgNjAyLjEyIDY0NSA2MTMgNjQ1QzYxMyA2ODcuNTcgNjEzIDczMC4xNCA2MTMgNzc0QzU5MS41NSA3NzQgNTcwLjEgNzc0IDU0OCA3NzRDNTQ4IDczMS40MyA1NDggNjg4Ljg2IDU0OCA2NDVDNTM3LjQ0IDY0NSA1MjYuODggNjQ1IDUxNiA2NDVDNTE2IDYzNC40NCA1MTYgNjIzLjg4IDUxNiA2MTNDNTA1LjQ0IDYxMyA0OTQuODggNjEzIDQ4NCA2MTNDNDg0IDYyMy41NiA0ODQgNjM0LjEyIDQ4NCA2NDVDNDczLjQ0IDY0NSA0NjIuODggNjQ1IDQ1MiA2NDVDNDUyIDY4Ny41NyA0NTIgNzMwLjE0IDQ1MiA3NzRDNDMwLjU1IDc3NCA0MDkuMSA3NzQgMzg3IDc3NEMzODcgNzMxLjQzIDM4NyA2ODguODYgMzg3IDY0NUMzOTcuNTYgNjQ1IDQwOC4xMiA2NDUgNDE5IDY0NUM0MTkgNjIzLjg4IDQxOSA2MDIuNzYgNDE5IDU4MUM0NDAuNDUgNTgxIDQ2MS45IDU4MSA0ODQgNTgxQzQ4NCA1NzAuMTEgNDg0IDU1OS4yMiA0ODQgNTQ4WiIgZmlsbD0id2hpdGUiLz4gPHBhdGggZD0iTTQ1MiAzODdDNDgzLjY4IDM4NyA1MTUuMzYgMzg3IDU0OCAzODdDNTQ4IDQxOS4wMSA1NDggNDUxLjAyIDU0OCA0ODRDNTM3LjQ0IDQ4NCA1MjYuODggNDg0IDUxNiA0ODRDNTE2IDQ3My40NCA1MTYgNDYyLjg4IDUxNiA0NTJDNTA1LjQ0IDQ1MiA0OTQuODggNDUyIDQ4NCA0NTJDNDg0IDQ0MS4xMSA0ODQgNDMwLjIyIDQ4NCA0MTlDNDczLjQ0IDQxOSA0NjIuODggNDE5IDQ1MiA0MTlDNDUyIDQwOC40NCA0NTIgMzk3Ljg4IDQ1MiAzODdaIiBmaWxsPSJ3aGl0ZSIvPiA8L2c+IDxkZWZzPiA8Y2xpcFBhdGggaWQ9ImNsaXAwXzY5OV8yMiI+IDxyZWN0IHdpZHRoPSIxMDAwIiBoZWlnaHQ9IjEwMDAiIGZpbGw9IndoaXRlIi8+IDwvY2xpcFBhdGg+IDwvZGVmcz4gPC9zdmc+";

#[allow(lint(share_owned))]
fun init(otw: IKA, ctx: &mut TxContext) {
    let (mut treasury_cap, coin_metadata) = coin::create_currency(
        otw,
        DECIMALS, // decimals,
        SYMBOL, // symbol,
        NAME, // name,
        DESCRIPTION, // description,
        option::some(url::new_unsafe_from_bytes(ICON_URL)),
        ctx,
    );

    let total_supply_to_mint = INITIAL_IKA_SUPPLY_TO_MINT * INKU_PER_IKA;
    let minted_coin = treasury_cap.mint(total_supply_to_mint, ctx);

    transfer::public_transfer(treasury_cap, ctx.sender());
    transfer::public_share_object(coin_metadata);

    transfer::public_transfer(minted_coin, ctx.sender());
}

/// Number of INKU per IKA.
public fun inku_per_ika(): u64 {
    INKU_PER_IKA
}

public fun get_staked_ika_icon_url(): vector<u8> {
    STAKED_IKA_ICON_URL
}

// === Test only ===

#[test_only]
use sui::test_scenario;

#[test_only]
public fun init_for_testing(ctx: &mut TxContext) {
    init(IKA {}, ctx);
}

#[test]
fun test_init() {
    let user = @0xa11ce;
    let mut test = test_scenario::begin(user);
    init(IKA {}, test.ctx());
    test.next_tx(user);

    let treasury_cap = test.take_from_address<coin::TreasuryCap<IKA>>(user);
    assert!(treasury_cap.total_supply() == 0);
    test.return_to_sender(treasury_cap);

    let coin_metadata = test.take_shared<coin::CoinMetadata<IKA>>();

    assert!(coin_metadata.get_decimals() == 9);
    assert!(coin_metadata.get_symbol() == b"IKA".to_ascii_string());
    assert!(coin_metadata.get_name() == b"IKA".to_string());
    assert!(coin_metadata.get_description() == b"IKA Token".to_string());
    assert!(coin_metadata.get_icon_url() == option::none());

    test_scenario::return_shared(coin_metadata);
    test.end();
}